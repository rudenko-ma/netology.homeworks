# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

## 1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

В Windows используется утилита `ipconfig`:
```
C:\Users\ruden> ipconfig /all

Настройка протокола IP для Windows

   Имя компьютера  . . . . . . . . . : pc-z
   Основной DNS-суффикс  . . . . . . :
   Тип узла. . . . . . . . . . . . . : Гибридный
   IP-маршрутизация включена . . . . : Нет
   WINS-прокси включен . . . . . . . : Нет

Адаптер Ethernet Ethernet 3:

   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : VirtualBox Host-Only Ethernet Adapter
   Физический адрес. . . . . . . . . : 0A-00-27-00-00-15
   DHCP включен. . . . . . . . . . . : Нет
   Автонастройка включена. . . . . . : Да
   Локальный IPv6-адрес канала . . . : fe80::1584:ad86:88d0:7e7a%21(Основной)
   IPv4-адрес. . . . . . . . . . . . : 192.168.56.1(Основной)
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Основной шлюз. . . . . . . . . :
   IAID DHCPv6 . . . . . . . . . . . : 705298471
   DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-68-97-03-2C-F0-5D-E0-A4-27
   NetBios через TCP/IP. . . . . . . . : Включен

Адаптер Ethernet vEthernet (External Switch):

   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Hyper-V Virtual Ethernet Adapter #2
   Физический адрес. . . . . . . . . : 2C-F0-5D-E0-A4-27
   DHCP включен. . . . . . . . . . . : Да
   Автонастройка включена. . . . . . : Да
   Локальный IPv6-адрес канала . . . : fe80::bdf1:f0c1:9da3:7ca0%9(Основной)
   IPv4-адрес. . . . . . . . . . . . : 192.168.88.10(Основной)
   Маска подсети . . . . . . . . . . : 255.255.255.0
   Аренда получена. . . . . . . . . . : 29 января 2022 г. 2:31:44
   Срок аренды истекает. . . . . . . . . . : 31 января 2022 г. 23:16:49
   Основной шлюз. . . . . . . . . : 192.168.88.1
   DHCP-сервер. . . . . . . . . . . : 192.168.88.1
   IAID DHCPv6 . . . . . . . . . . . : 489484381
   DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-68-97-03-2C-F0-5D-E0-A4-27
   DNS-серверы. . . . . . . . . . . : 192.168.88.1
                                       194.85.113.243
                                       212.122.1.2
   NetBios через TCP/IP. . . . . . . . : Включен

Адаптер Ethernet Сетевое подключение Bluetooth:

   Состояние среды. . . . . . . . : Среда передачи недоступна.
   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Bluetooth Device (Personal Area Network)
   Физический адрес. . . . . . . . . : 00-E0-3C-A4-39-03
   DHCP включен. . . . . . . . . . . : Да
   Автонастройка включена. . . . . . : Да

Адаптер Ethernet vEthernet (Default Switch):

   DNS-суффикс подключения . . . . . :
   Описание. . . . . . . . . . . . . : Hyper-V Virtual Ethernet Adapter
   Физический адрес. . . . . . . . . : 00-15-5D-40-92-06
   DHCP включен. . . . . . . . . . . : Нет
   Автонастройка включена. . . . . . : Да
   Локальный IPv6-адрес канала . . . : fe80::b4cb:4da8:9bd1:b8b4%27(Основной)
   IPv4-адрес. . . . . . . . . . . . : 172.24.240.1(Основной)
   Маска подсети . . . . . . . . . . : 255.255.240.0
   Основной шлюз. . . . . . . . . :
   IAID DHCPv6 . . . . . . . . . . . : 452990301
   DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-68-97-03-2C-F0-5D-E0-A4-27
   NetBios через TCP/IP. . . . . . . . : Включен
```

В Linux актуальной считается утилита `ip` входящая в состав `iproute2`:
```
# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:15:5d:58:0a:06 brd ff:ff:ff:ff:ff:ff
    inet 192.168.88.100/24 brd 192.168.88.255 scope global dynamic noprefixroute eth0
       valid_lft 342sec preferred_lft 342sec
    inet6 fe80::d41d:96e2:8ff7:f33d/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:42:7b:c6 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
4: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc fq_codel master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:42:7b:c6 brd ff:ff:ff:ff:ff:ff
5: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:7c:4e:7c:e8 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
```

## 2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

Для распознавания характеристика сетевого оборудования в ЛС используется протоколо `Link Layer Discovery Protocol`. 

В Linux есть команда `lldpctl` из пакета `lldpd`.

## 3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

Для этого используется технология `VLAN`. В Ubuntu поддерживается пакетом `vlan`.

Постаянная конфигруация зависит от версии дистрибутива и отличается для разных сетевых менеджеров (`NetworkManager`, `netplan` и т.д.).

Пример временной конфигурации:

```
vagrant@ubuntu2004:~$ sudo vconfig add eth0 42

Warning: vconfig is deprecated and might be removed in the future, please migrate to ip(route2) as soon as possible!

vagrant@ubuntu2004:~$ sudo ip addr add 10.9.8.1/24 dev eth0.42
vagrant@ubuntu2004:~$ sudo ip link set up eth0.42
vagrant@ubuntu2004:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:06:2d:be brd ff:ff:ff:ff:ff:ff
    inet 192.168.121.172/24 brd 192.168.121.255 scope global dynamic eth0
       valid_lft 3469sec preferred_lft 3469sec
    inet6 fe80::5054:ff:fe06:2dbe/64 scope link 
       valid_lft forever preferred_lft forever
3: eth0.42@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 52:54:00:06:2d:be brd ff:ff:ff:ff:ff:ff
    inet 10.9.8.1/24 scope global eth0.42
       valid_lft forever preferred_lft forever 

```

Добавили VLAN 42 на основной сетевой интерфейс и присвоили ему IP адрес.

## 4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

Типы агрегации интерфейсов в Linux:

- **Mode-0(balance-rr)** – Данный режим используется по умолчанию. Balance-rr обеспечивается балансировку нагрузки и отказоустойчивость. В данном режиме сетевые пакеты отправляются “по кругу”, от первого интерфейса к последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.

- **Mode-1(active-backup)** – Один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.

- **Mode-2(balance-xor)** – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает балансировку нагрузки и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.

- **Mode-3(broadcast)** – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.

- **Mode-4(802.3ad)** – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.

- **Mode-5(balance-tlb)** – Адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

- **Mode-6(balance-alb)** – Адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

Важные опции балансировки:
- `arp_interval` — определяет ARP мониторинг канала (задаётся в миллисекундах). Значение по умолчанию 0 (выключен)
- `arp_ip_target` — Указывает IP адреса для ARP мониторинга (используется, если arp_interval >0).
- `arp_validate` — Определяет будут или нет проверяться ARP запросы и ответы при использовании режима active-backup.
- `downdelay` — Определяет время (в миллисекундах) задержки перед отключением интерфейса, если произошел сбой соединения.
- `updelay` — Задает время задержки в миллисекундах, перед тем как поднять линк при обнаружении восстановления канала.
- `lacp_rate` — Определяет с каким интервалом будут передаваться партнёром LACPDU пакеты в режиме 802.3a.
- `miimon` — Устанавливает периодичность MII мониторинга в миллисекундах.
- `xmit_hash_policy` — Определяет хэш политику передачи пакетов через объединенные интерфейсы в режиме balance-xor или 802.3ad.

Пример конфига `netplan` для Ubuntu 20.04:
```
network:
  version: 2
  renderer: networkd
  bonds:
    bond0:
      interfaces:
      - eth0
      - eth1
      parameters:
        mode: active-backup
  ethernets:
    eth0: {}
    eth1: {}
  bridges:
    br0:
      addresses:
        - 192.168.1.100/24
      dhcp4: false
      gateway4: 192.168.1.1
      nameservers:
        addresses:
          - 192.168.1.1
          - 77.88.8.8
          - 8.8.8.8
        search: []
      interfaces:
        - bond0
```

## 5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

Подсеть `/29` содержит 8 адресов (6 из них доступны для использования на хостах):
```
# ipcalc 10.10.10.0/29                    
Address:   10.10.10.0           00001010.00001010.00001010.00000 000
Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
=>
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

```

Подсеть `/24` содержит 256 адресов, т.е. может быть разделена на **32** подсети `/29`.

Адреса подсетей `/29`:
- 10.10.10.0/29
- 10.10.10.8/29
- 10.10.10.16/29
- 10.10.10.24/29
- 10.10.10.32/29
- 10.10.10.40/29
- 10.10.10.48/29
- 10.10.10.56/29
- 10.10.10.64/29
- 10.10.10.72/29
- 10.10.10.80/29
- 10.10.10.88/29
- 10.10.10.96/29
- 10.10.10.104/29
- 10.10.10.112/29
- 10.10.10.120/29
- 10.10.10.128/29
- 10.10.10.136/29
- 10.10.10.144/29
- 10.10.10.152/29
- 10.10.10.160/29
- 10.10.10.168/29
- 10.10.10.176/29
- 10.10.10.184/29
- 10.10.10.192/29
- 10.10.10.200/29
- 10.10.10.208/29
- 10.10.10.216/29
- 10.10.10.224/29
- 10.10.10.232/29
- 10.10.10.240/29
- 10.10.10.248/29

## 6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

Остался диапазон `100.64.0.0/10` также зарезервированный для частного использования.

Определим подходящую маску:
```
# ipcalc 100.64.0.0/10 -s 50
Address:   100.64.0.0           01100100.01 000000.00000000.00000000
Netmask:   255.192.0.0 = 10     11111111.11 000000.00000000.00000000
Wildcard:  0.63.255.255         00000000.00 111111.11111111.11111111
=>
Network:   100.64.0.0/10        01100100.01 000000.00000000.00000000
HostMin:   100.64.0.1           01100100.01 000000.00000000.00000001
HostMax:   100.127.255.254      01100100.01 111111.11111111.11111110
Broadcast: 100.127.255.255      01100100.01 111111.11111111.11111111
Hosts/Net: 4194302               Class A

1. Requested size: 50 hosts
Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
Hosts/Net: 62                    Class A

Needed size:  64 addresses.
Used network: 100.64.0.0/26
Unused:
100.64.0.64/26
100.64.0.128/25
100.64.1.0/24
100.64.2.0/23
100.64.4.0/22
100.64.8.0/21
100.64.16.0/20
100.64.32.0/19
100.64.64.0/18
100.64.128.0/17
100.65.0.0/16
100.66.0.0/15
100.68.0.0/14
100.72.0.0/13
100.80.0.0/12
100.96.0.0/11
```

Лучше всего нам подходит маска `/26`.

## 7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

Смотрим `arp` таблицу в Windows: `arp -a`

Команда для очистки в Windows: `netsh interface ip delete arpcache`

Смотрим `arp` таблицу в Linux: `ip neigh show all`

Команда для очистки в Linux: `ip neigh flush all`

Команда для удаления одной записи: `ip neigh del 192.168.33.25 lladdr 52:54:00:06:2d:be dev eth0`

